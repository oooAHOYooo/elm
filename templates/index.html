{% extends "base.html" %}
{% block head_extra %}
<link rel="stylesheet"
    href="{{ url_for('static', filename='css/hours.css') }}" />
{% endblock %}
{% block content %}
<div class="newspaper" id="js-fit">
    <!-- Masthead -->
    <header class="masthead">
        <div class="masthead__edition">New Haven, Connecticut</div>
        <h1 class="masthead__title">Elm City Daily</h1>
        <div class="masthead__meta">
            <time class="masthead__date">{{ date_str }}</time>
            <span class="masthead__separator">¬∑</span>
            <span class="masthead__tagline">Your Daily Civic Digest</span>
            <span class="masthead__separator">¬∑</span>
            <a href="#hours">Hours</a>
            <button class="masthead__theme" id="js-dark-toggle" type="button"
                aria-label="Toggle theme">
                <span id="js-theme-icon" class="theme-icon"></span>
            </button>
        </div>
        <div class="masthead__rule"></div>
    </header>

    <!-- Above the Fold -->
    <main class="broadsheet">
        <!-- Lead Column: Weather & Conditions -->
        <section class="col col--lead" aria-label="Weather and Conditions">
            <article class="weather-block">
                <h2 class="section-head">Today's Conditions</h2>
                <div class="weather-hero">
                    <div class="weather-ticker">
                        <div class="weather-ticker__label">New Haven</div>
                        <div class="weather-ticker__temp" id="js-temp">
                            {% if weather and weather.current_temp is not none
                            %}
                            {{ weather.current_temp|round|int }}¬∞
                            {% else %}--{% endif %}
                        </div>
                        <div class="weather-ticker__clock"
                            id="js-clock">--:--:--</div>
                    </div>
                    <div class="weather-hero__desc">
                        {{ weather.weather_desc if weather else 'Loading...' }}
                    </div>
                </div>
                <div class="weather-details">
                    <div class="weather-stat">
                        <span class="weather-stat__label">High</span>
                        <span class="weather-stat__value" id="js-high">{{
                            weather.high_temp|round|int if weather and
                            weather.high_temp else '--' }}¬∞</span>
                    </div>
                    <div class="weather-stat">
                        <span class="weather-stat__label">Low</span>
                        <span class="weather-stat__value" id="js-low">{{
                            weather.low_temp|round|int if weather and
                            weather.low_temp else '--' }}¬∞</span>
                    </div>
                    <div class="weather-stat">
                        <span class="weather-stat__label">Sunrise</span>
                        <span class="weather-stat__value">{{ weather.sunrise if
                            weather and weather.sunrise else '--' }}</span>
                    </div>
                    <div class="weather-stat">
                        <span class="weather-stat__label">Sunset</span>
                        <span class="weather-stat__value">{{ weather.sunset if
                            weather and weather.sunset else '--' }}</span>
                    </div>
                </div>
                {% if air_quality and air_quality.available %}
                <div class="aqi-inline">
                    <span class="aqi-inline__badge"
                        style="background:{{ air_quality.color }}">{{
                        air_quality.aqi }}</span>
                    <span class="aqi-inline__text">{{ air_quality.category }}
                        Air Quality</span>
                </div>
                {% endif %}
            </article>

            <article class="tides-block">
                <h2 class="section-head">Harbor Tides</h2>
                <div id="js-tide-output" class="tides-content">Loading
                    tides...</div>
            </article>

            {% if nws_alerts and nws_alerts|length > 0 %}
            <article class="alerts-block">
                <h2 class="section-head section-head--alert">‚ö† Weather
                    Alerts</h2>
                {% for al in nws_alerts %}
                <a href="{{ al.link }}" target="_blank" rel="noopener"
                    class="alert-item">
                    <strong>{{ al.event }}</strong>: {{ al.headline|truncate(80)
                    if al.headline else al.title }}
                </a>
                {% endfor %}
            </article>
            {% endif %}
        </section>

        <!-- Center Column: Events Calendar -->
        <section class="col col--center" aria-label="This Week's Events">
            <h2 class="section-head section-head--large">What's happening this
                week</h2>
            <p class="events-meta">Updated recently ‚Ä¢ Sources: city calendar +
                partner feeds</p>
            <div class="week-nav">
                <button id="js-week-prev" class="week-nav__btn"
                    aria-label="Previous week">‚Äπ Prev</button>
                <span id="js-week-label" class="week-nav__label">Week of {{
                    week_start_date|default('Today') }}</span>
                <button id="js-week-next" class="week-nav__btn"
                    aria-label="Next week">Next ‚Ä∫</button>
            </div>

            <div class="events-list" id="js-agenda-week">
                {% for day in week_grid %}
                <div class="events-day-group">
                    <h3 class="events-day-group__header">{{ day.label }}</h3>
                    <div class="events-day-group__cards">
                        {% for it in day['items'] %}
                        <article class="event-card" tabindex="0" role="button"
                            aria-label="Event: {{ it.title }}"
                            data-title="{{ it.title }}"
                            data-time="{{ it.time }}"
                            data-link="{{ it.link or '' }}"
                            data-location="{{ it.location or '' }}"
                            data-source="{{ it.source or '' }}"
                            data-date="{{ it.date }}"
                            data-summary="{{ it.summary | e }}">
                            <div class="event-card__time">
                                <span class="event-card__time-value">{{ it.time
                                    }}</span>
                                <span class="event-card__day-label">{{ day.label
                                    }}</span>
                            </div>
                            <div class="event-card__content">
                                <h4 class="event-card__title">{{ it.title
                                    }}</h4>
                                {% if it.location %}
                                <p class="event-card__location">{{ it.location
                                    }}</p>
                                {% endif %}
                                {% if it.summary %}
                                <p class="event-card__description">{{
                                    it.summary|truncate(80) }}</p>
                                {% endif %}
                                <button class="event-card__more"
                                    aria-label="View more details">More details
                                    ‚Üí</button>
                            </div>
                        </article>
                        {% else %}
                        <p class="events-day-group__empty">‚Äî No public events
                            listed</p>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Event Detail Drawer -->
            <div class="event-drawer" id="js-event-drawer" role="dialog"
                aria-labelledby="js-drawer-title" aria-hidden="true">
                <div class="event-drawer__overlay" id="js-drawer-overlay"></div>
                <div class="event-drawer__panel">
                    <div class="event-drawer__header">
                        <h3 id="js-drawer-title"
                            class="event-drawer__title">Event Details</h3>
                        <button class="event-drawer__close" id="js-drawer-close"
                            aria-label="Close event details">√ó</button>
                    </div>
                    <div class="event-drawer__body">
                        <div class="event-drawer__meta">
                            <div class="event-drawer__meta-item"
                                id="js-drawer-time">
                                <strong>Time:</strong> <span></span>
                            </div>
                            <div class="event-drawer__meta-item"
                                id="js-drawer-location">
                                <strong>Location:</strong> <span></span>
                            </div>
                            <div class="event-drawer__meta-item"
                                id="js-drawer-source">
                                <strong>Source:</strong> <span></span>
                            </div>
                        </div>
                        <div class="event-drawer__description"
                            id="js-drawer-description"></div>
                        <div class="event-drawer__footer" id="js-drawer-footer"
                            style="display:none;">
                            <a class="event-drawer__link" id="js-drawer-link"
                                href="#" target="_blank" rel="noopener">Read
                                more ‚Üí</a>
                        </div>
                    </div>
                </div>
            </div>
            <input type="hidden" id="js-week-offset" value="0" />
        </section>

        <!-- Right Column: City Info & Quick Links -->
        <section class="col col--sidebar" aria-label="City Information">
            <!-- Mill Rate & Fiscal Info -->
            {% if tax_info %}
            <article class="infobox">
                <h2 class="section-head">City Finance</h2>
                <div class="stat-row">
                    <span class="stat-row__label">Mill Rate</span>
                    <span class="stat-row__value">{{ tax_info.mill_rate
                        }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-row__label">Fiscal Year</span>
                    <span class="stat-row__value">{{ tax_info.fiscal_year
                        }}</span>
                </div>
            </article>
            {% endif %}

            <!-- Moon Phases -->
            <article class="infobox infobox--moon">
                <h2 class="section-head">Moon Phases</h2>
                <div class="moon-phases" id="js-moon-phases">
                    <div class="moon-phase">
                        <div class="moon-phase__icon" id="js-moon-today"></div>
                        <div class="moon-phase__label">Today</div>
                        <div class="moon-phase__name"
                            id="js-moon-name-today">--</div>
                    </div>
                    <div class="moon-phase">
                        <div class="moon-phase__icon" id="js-moon-day3"></div>
                        <div class="moon-phase__label"
                            id="js-moon-label-day3">+3 days</div>
                        <div class="moon-phase__name"
                            id="js-moon-name-day3">--</div>
                    </div>
                    <div class="moon-phase">
                        <div class="moon-phase__icon" id="js-moon-day7"></div>
                        <div class="moon-phase__label"
                            id="js-moon-label-day7">+7 days</div>
                        <div class="moon-phase__name"
                            id="js-moon-name-day7">--</div>
                    </div>
                    <div class="moon-phase">
                        <div class="moon-phase__icon" id="js-moon-day14"></div>
                        <div class="moon-phase__label"
                            id="js-moon-label-day14">+14 days</div>
                        <div class="moon-phase__name"
                            id="js-moon-name-day14">--</div>
                    </div>
                </div>
            </article>

            <!-- Sun Phases -->
            <article class="infobox infobox--sun">
                <h2 class="section-head">Sun Phases</h2>
                <div class="sun-phases" id="js-sun-phases">
                    <div class="sun-phase">
                        <div class="sun-phase__icon"
                            id="js-sun-icon-today"></div>
                        <div class="sun-phase__label">Today</div>
                        <div class="sun-phase__name"
                            id="js-sun-name-today">--</div>
                    </div>
                    <div class="sun-phase">
                        <div class="sun-phase__icon"
                            id="js-sun-icon-tomorrow"></div>
                        <div class="sun-phase__label">Tomorrow</div>
                        <div class="sun-phase__name"
                            id="js-sun-name-tomorrow">--</div>
                    </div>
                    <div class="sun-phase">
                        <div class="sun-phase__icon"
                            id="js-sun-icon-day3"></div>
                        <div class="sun-phase__label" id="js-sun-label-day3">Day
                            3</div>
                        <div class="sun-phase__name"
                            id="js-sun-name-day3">--</div>
                    </div>
                </div>
            </article>

            <!-- Upcoming Meetings -->
            {% if boards_upcoming %}
            <article class="infobox">
                <h2 class="section-head">Upcoming Meetings</h2>
                <ul class="meeting-list">
                    {% for m in boards_upcoming[:5] %}
                    <li class="meeting-item">
                        <a href="{{ m.link or '#' }}" target="_blank"
                            rel="noopener">
                            <span class="meeting-item__title">{{
                                m.title|truncate(40) }}</span>
                            <span class="meeting-item__date">{{ m.date }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </article>
            {% endif %}

            <!-- Quick Links with Popups -->
            <article class="infobox infobox--links">
                <h2 class="section-head">Quick Links</h2>
                <div class="quick-links">
                    <button class="quick-link" data-popup="seeclickfix">
                        <span
                            class="quick-link__icon quick-link__icon--report"></span>
                        Report Issue</button>
                    <button class="quick-link" data-popup="cityhall">
                        <span
                            class="quick-link__icon quick-link__icon--phone"></span>
                        City Hall</button>
                    <button class="quick-link" data-popup="library">
                        <span
                            class="quick-link__icon quick-link__icon--library"></span>
                        Library</button>
                    <button class="quick-link" data-popup="recycling">
                        <span
                            class="quick-link__icon quick-link__icon--recycle"></span>
                        Recycling</button>
                    <button class="quick-link" data-popup="parking">
                        <span
                            class="quick-link__icon quick-link__icon--parking"></span>
                        Parking</button>
                    <button class="quick-link" data-popup="transit">
                        <span
                            class="quick-link__icon quick-link__icon--transit"></span>
                        Transit</button>
                </div>
            </article>

            <!-- Map -->
            <article class="infobox infobox--map">
                <h2 class="section-head">New Haven</h2>
                <div class="map-embed">
                    <iframe id="js-map-frame" title="New Haven Map"
                        loading="lazy"
                        data-lat="{{ center_lat }}"
                        data-lon="{{ center_lon }}"></iframe>
                </div>
            </article>

            <!-- Sponsors -->
            <article class="infobox infobox--sponsors">
                <h2 class="section-head">New Haven Hangouts</h2>
                <a href="https://app.ahoy.ooo" target="_blank"
                    rel="noopener sponsored" class="sponsor">
                    <span class="sponsor__icon sponsor__icon--anchor"></span>
                    <span class="sponsor__name">Ahoy Indie Media</span>
                </a>
                <div class="sponsor sponsor--placeholder">
                    <span class="sponsor__icon sponsor__icon--pin"></span>
                    <span class="sponsor__name">Your Business Here</span>
                </div>
            </article>
        </section>
    </main>

    <!-- Hours Directory (Pull-out Supplement) -->
    {% if hours_all %}
    <section class="hours-home" id="hours" aria-label="Hours Directory">
        <h2 class="section-head section-head--large">Hours Directory</h2>
        <p class="hours-kicker">A pull-out neighborhood directory ‚Äî expand
            sections to browse without leaving the front page.</p>
        <details class="hours-home__details">
            <summary class="hours-home__summary">Open the Hours
                Directory</summary>
            <div class="hours-layout"
                aria-label="Business hours by neighborhood">
                <aside class="hours-card" aria-label="Hours tools">
                    <h3 class="section-head">Browse</h3>
                    <p class="hours-note">
                        Neighborhoods are ‚Äúsections.‚Äù Rows show <strong>today‚Äôs
                            hours</strong>; expand for the weekly table.
                    </p>
                </aside>

                <section class="hours-sections"
                    aria-label="Neighborhood sections">
                    {% for n in hours_all %}
                    <details class="hours-section" {% if loop.index <=2 %}open{%
                        endif %}>
                        <summary>
                            <div class="hours-section__title">
                                <div class="hours-section__name">{{ n.name
                                    }}</div>
                                <div class="hours-section__dek">{{ n.kicker
                                    }}</div>
                            </div>
                            <div class="hours-section__meta"
                                aria-label="Neighborhood summary">
                                <span class="hours-pill hours-pill--open">Open
                                    now: {{ n.open_now }}</span>
                                <span class="hours-pill">Listed: {{ n.total
                                    }}</span>
                            </div>
                        </summary>

                        <div class="hours-list">
                            {% for b in n.businesses %}
                            <details class="biz">
                                <summary>
                                    <span class="biz__name">{{ b.name }}</span>
                                    <span class="biz__today">Today: {{ b.today
                                        }}</span>
                                    <span class="biz__badges">
                                        <span class="biz__badge">{{ b.category
                                            }}</span>
                                        {% if b.status == "open" %}
                                        <span
                                            class="biz__badge biz__badge--open">Open</span>
                                        {% else %}
                                        <span
                                            class="biz__badge biz__badge--closed">Closed</span>
                                        {% endif %}
                                    </span>
                                </summary>
                                <div class="biz__details">
                                    <div class="biz__grid">
                                        <div>
                                            <h4 class="section-head">Weekly
                                                hours</h4>
                                            <table class="biz__table"
                                                aria-label="Weekly hours for {{ b.name }}">
                                                <tbody>
                                                    {% for row in b.week %}
                                                    <tr>
                                                        <td>{{ row.day }}</td>
                                                        <td>{{ row.hours }}</td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                        <div>
                                            <h4 class="section-head">Record</h4>
                                            <p
                                                class="hours-note"><strong>Address:</strong>
                                                {{ b.address }}</p>
                                            <p
                                                class="hours-note"><strong>Phone:</strong>
                                                {{ b.phone }}</p>
                                            <p
                                                class="hours-note"><strong>Source:</strong>
                                                {{ b.source }}</p>
                                        </div>
                                    </div>
                                </div>
                            </details>
                            {% endfor %}
                        </div>
                    </details>
                    {% endfor %}
                </section>

                <aside class="hours-card" aria-label="Editorial note">
                    <h3 class="section-head">Editor‚Äôs note</h3>
                    <p class="hours-note">When you have lots of businesses,
                        we‚Äôll keep this fast by loading neighborhoods on-demand
                        (still on the homepage).</p>
                </aside>
            </div>
        </details>
    </section>
    {% endif %}

    <!-- Footer -->
    <footer class="footer">
        <div class="footer__rule"></div>
        <nav class="footer__nav">
            <a href="{{ url_for('about') }}">About</a>
            <a href="{{ url_for('feeds_api') }}">API</a>
            <a href="{{ url_for('feeds_rss') }}" title="RSS Feed">üì∞ RSS</a>
            <button type="button" id="js-refresh" class="footer__refresh">‚Üª
                Refresh</button>
        </nav>
        <div class="footer__freshness">
            <span id="js-last-updated">Updated just now</span>
        </div>
        <div class="footer__copy">
            ¬© {{ date_str.split(',')[-1].strip() }} Elm City Daily ¬∑ New Haven,
            CT
        </div>
    </footer>
</div>

<!-- Popup Panels -->
<div class="popup-overlay" id="popup-overlay"></div>

<div class="popup-panel" id="popup-seeclickfix" data-popup="seeclickfix">
    <div class="popup-header">
        <h3><span class="popup-header__icon popup-header__icon--report"></span>
            Report an Issue</h3>
        <button class="popup-close" aria-label="Close">√ó</button>
    </div>
    <div class="popup-body">
        <iframe src="https://seeclickfix.com/new-haven"
            title="SeeClickFix"></iframe>
    </div>
    <div class="popup-footer">
        <a href="https://seeclickfix.com/new-haven" target="_blank"
            rel="noopener">Open in new tab ‚Üí</a>
    </div>
</div>

<div class="popup-panel" id="popup-cityhall" data-popup="cityhall">
    <div class="popup-header">
        <h3><span class="popup-header__icon popup-header__icon--phone"></span>
            City Hall</h3>
        <button class="popup-close" aria-label="Close">√ó</button>
    </div>
    <div class="popup-body popup-body--content">
        <div class="popup-info">
            <h4>New Haven City Hall</h4>
            <p>165 Church Street, New Haven, CT 06510</p>
            <div class="popup-stat"><strong>Main:</strong> <a
                    href="tel:+12039464800">(203) 946-4800</a></div>
            <div class="popup-stat"><strong>311:</strong> <a
                    href="tel:311">311</a></div>
            <div class="popup-stat"><strong>Hours:</strong> Mon-Fri
                9am-5pm</div>
        </div>
        <div class="popup-section">
            <h5>Key Departments</h5>
            <ul>
                <li><strong>Mayor's Office:</strong> (203) 946-8200</li>
                <li><strong>City Clerk:</strong> (203) 946-8350</li>
                <li><strong>Finance:</strong> (203) 946-6480</li>
                <li><strong>Public Works:</strong> (203) 946-8112</li>
                <li><strong>Parks & Rec:</strong> (203) 946-8027</li>
            </ul>
        </div>
    </div>
    <div class="popup-footer">
        <a href="https://www.newhavenct.gov" target="_blank"
            rel="noopener">Visit City Website ‚Üí</a>
    </div>
</div>

<div class="popup-panel" id="popup-library" data-popup="library">
    <div class="popup-header">
        <h3><span class="popup-header__icon popup-header__icon--library"></span>
            Library</h3>
        <button class="popup-close" aria-label="Close">√ó</button>
    </div>
    <div class="popup-body popup-body--content">
        <div class="popup-info">
            <h4>New Haven Free Public Library</h4>
            <p>133 Elm Street (Ives Main)</p>
            <div class="popup-stat"><strong>Phone:</strong> <a
                    href="tel:+12039468130">(203) 946-8130</a></div>
        </div>
        <div class="popup-section">
            <h5>Branch Hours Today</h5>
            <ul>
                <li><strong>Ives Main:</strong> 10am - 8pm</li>
                <li><strong>Fair Haven:</strong> 10am - 6pm</li>
                <li><strong>Mitchell:</strong> 10am - 6pm</li>
                <li><strong>Stetson:</strong> 10am - 6pm</li>
                <li><strong>Wilson:</strong> 10am - 6pm</li>
            </ul>
        </div>
        <div class="popup-section">
            <h5>Quick Services</h5>
            <ul>
                <li>Free WiFi & Computer Access</li>
                <li>3D Printing & Makerspace</li>
                <li>Museum Passes Available</li>
                <li>ESL Classes & Tutoring</li>
            </ul>
        </div>
    </div>
    <div class="popup-footer">
        <a href="https://nhfpl.org" target="_blank" rel="noopener">Visit NHFPL
            ‚Üí</a>
    </div>
</div>

<div class="popup-panel" id="popup-recycling" data-popup="recycling">
    <div class="popup-header">
        <h3><span class="popup-header__icon popup-header__icon--recycle"></span>
            Trash & Recycling</h3>
        <button class="popup-close" aria-label="Close">√ó</button>
    </div>
    <div class="popup-body popup-body--content">
        <div class="popup-info">
            <h4>Collection Schedule</h4>
            <div class="popup-stat"><strong>Hotline:</strong> <a
                    href="tel:+12039467700">(203) 946-7700</a></div>
        </div>
        <div class="popup-section">
            <h5>This Week's Pickup</h5>
            <ul>
                <li><strong>Zone A (Downtown):</strong> Monday</li>
                <li><strong>Zone B (East Rock/Westville):</strong> Tuesday</li>
                <li><strong>Zone C (Fair Haven/Annex):</strong> Wednesday</li>
                <li><strong>Zone D (Dixwell/Newhallville):</strong>
                    Thursday</li>
                <li><strong>Zone E (West/Hill):</strong> Friday</li>
            </ul>
        </div>
        <div class="popup-section">
            <h5>What Goes Where</h5>
            <ul>
                <li>üîµ <strong>Blue Bin:</strong> Paper, cardboard, plastics
                    1-7</li>
                <li>üü¢ <strong>Green Bin:</strong> Glass bottles & jars</li>
                <li>‚¨õ <strong>Trash:</strong> Everything else</li>
                <li>üçÇ <strong>Yard Waste:</strong> Paper bags only,
                    Apr-Dec</li>
            </ul>
        </div>
    </div>
    <div class="popup-footer">
        <a href="https://www.newhavenct.gov/residents/trash-recycling"
            target="_blank" rel="noopener">Full Schedule ‚Üí</a>
    </div>
</div>

<div class="popup-panel" id="popup-parking" data-popup="parking">
    <div class="popup-header">
        <h3><span class="popup-header__icon popup-header__icon--parking"></span>
            Parking</h3>
        <button class="popup-close" aria-label="Close">√ó</button>
    </div>
    <div class="popup-body popup-body--content">
        <div class="popup-info">
            <h4>Parking Authority</h4>
            <div class="popup-stat"><strong>Phone:</strong> <a
                    href="tel:+12039468075">(203) 946-8075</a></div>
        </div>
        <div class="popup-section">
            <h5>Downtown Garages</h5>
            <ul>
                <li><strong>Temple St:</strong> üü¢ Available (342/500)</li>
                <li><strong>Crown St:</strong> üü° Filling (89/200)</li>
                <li><strong>Air Rights:</strong> üü¢ Available (567/800)</li>
                <li><strong>Church St South:</strong> üü¢ Available
                    (234/400)</li>
            </ul>
        </div>
        <div class="popup-section">
            <h5>Meter Rates</h5>
            <ul>
                <li><strong>Downtown:</strong> $1.50/hr (2hr max)</li>
                <li><strong>Residential:</strong> $0.75/hr</li>
                <li><strong>Evenings (6pm+):</strong> Free</li>
                <li><strong>Sundays:</strong> Free</li>
            </ul>
        </div>
    </div>
    <div class="popup-footer">
        <a href="https://www.newhavenct.gov/residents/parking" target="_blank"
            rel="noopener">Pay Ticket Online ‚Üí</a>
    </div>
</div>

<div class="popup-panel" id="popup-transit" data-popup="transit">
    <div class="popup-header">
        <h3><span class="popup-header__icon popup-header__icon--transit"></span>
            Transit</h3>
        <button class="popup-close" aria-label="Close">√ó</button>
    </div>
    <div class="popup-body popup-body--content">
        <div class="popup-info">
            <h4>CT Transit New Haven</h4>
            <div class="popup-stat"><strong>Info:</strong> <a
                    href="tel:+12036247433">(203) 624-0151</a></div>
        </div>
        <div class="popup-section">
            <h5>Union Station Departures</h5>
            <ul>
                <li><strong>Route B1 (Branford):</strong> 12 min</li>
                <li><strong>Route C (Downtown):</strong> 5 min</li>
                <li><strong>Route D (Long Wharf):</strong> 8 min</li>
                <li><strong>Route J (Yale):</strong> 3 min</li>
                <li><strong>Route O (Orange):</strong> 15 min</li>
            </ul>
        </div>
        <div class="popup-section">
            <h5>Metro-North (Shore Line East)</h5>
            <ul>
                <li><strong>To NYC:</strong> Next train 2:45pm</li>
                <li><strong>To Stamford:</strong> Next train 3:12pm</li>
                <li><strong>To New London:</strong> Next train 2:58pm</li>
            </ul>
        </div>
    </div>
    <div class="popup-footer">
        <a href="https://www.cttransit.com" target="_blank" rel="noopener">CT
            Transit ‚Üí</a>
    </div>
</div>

<script>
window.WEATHER_DATA = {
    current_temp: {% if weather and weather.current_temp is not none %}{{ weather.current_temp }}{% else %}null{% endif %},
    high_temp: {% if weather and weather.high_temp is not none %}{{ weather.high_temp }}{% else %}null{% endif %},
    low_temp: {% if weather and weather.low_temp is not none %}{{ weather.low_temp }}{% else %}null{% endif %},
    weather_desc: {% if weather and weather.weather_desc %}{{ weather.weather_desc|tojson|safe }}{% else %}""{% endif %},
    sunrise: {% if weather and weather.sunrise %}{{ weather.sunrise|tojson|safe }}{% else %}null{% endif %},
    sunset: {% if weather and weather.sunset %}{{ weather.sunset|tojson|safe }}{% else %}null{% endif %}
};
window.WEEK_GRID = {{ week_grid|tojson|safe if week_grid else '[]' }};
</script>
{% endblock %}
